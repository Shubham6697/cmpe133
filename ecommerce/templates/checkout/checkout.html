{% extends 'html/nav.html' %}  {% load static %}{% block content %}
<head>
        <link rel="stylesheet" href="{% static "assests/checkout.css" %}">
</head>
<body>
    {% if address1 == False %}
                <h4 class="text-center">{{ message }}</h4>
                <form action="{%  url "checkout" %}" method="POST">
                        {% csrf_token %}                   
                        <span><h4>Address</h4><input class="form-control text-center" name='address' placeholder='Your address' value='{{ address.address }}' type='text' required></span>
                        <span><h4>City</h4><input class="form-control text-center" name='city' placeholder='Your City' value='{{ address.city }}' type="text" required></span>
                        <span>
                                <h4>State</h4>
                                <select style=" text-align: center; text-align-last: center;" class="form-control text-center" id="sel"  name="state" >
                                        <option value="Andhra Pradesh">Andhra Pradesh</option>
                                        <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                                        <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                        <option value="Assam">Assam</option>
                                        <option value="Bihar">Bihar</option>
                                        <option value="Chandigarh">Chandigarh</option>
                                        <option value="Chhattisgarh">Chhattisgarh</option>
                                        <option value="Dadar and Nagar Haveli">Dadar and Nagar Haveli</option>
                                        <option value="Daman and Diu">Daman and Diu</option>
                                        <option value="Delhi">Delhi</option>
                                        <option value="Lakshadweep">Lakshadweep</option>
                                        <option value="Puducherry">Puducherry</option>
                                        <option value="Goa">Goa</option>
                                        <option value="Gujarat">Gujarat</option>
                                        <option value="Haryana">Haryana</option>
                                        <option value="Himachal Pradesh">Himachal Pradesh</option>
                                        <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                        <option value="Jharkhand">Jharkhand</option>
                                        <option value="Karnataka">Karnataka</option>
                                        <option value="Kerala">Kerala</option>
                                        <option value="Madhya Pradesh">Madhya Pradesh</option>
                                        <option value="Maharashtra">Maharashtra</option>
                                        <option value="Manipur">Manipur</option>
                                        <option value="Meghalaya">Meghalaya</option>
                                        <option value="Mizoram">Mizoram</option>
                                        <option value="Nagaland">Nagaland</option>
                                        <option value="Odisha">Odisha</option>
                                        <option value="Punjab">Punjab</option>
                                        <option value="Rajasthan">Rajasthan</option>
                                        <option value="Sikkim">Sikkim</option>
                                        <option value="Tamil Nadu">Tamil Nadu</option>
                                        <option value="Telangana">Telangana</option>
                                        <option value="Tripura">Tripura</option>
                                        <option value="Uttar Pradesh">Uttar Pradesh</option>
                                        <option value="Uttarakhand">Uttarakhand</option>
                                        <option value="West Bengal">West Bengal</option>
                                </select>	
                        </span>
                        <span><h4>Pin Code</h4><input  class="form-control text-center" name="zipcode" type="text" inputmode="numeric" pattern="^(?(^00000(|-0000))|(\d{5}(|-\d{4})))$" placeholder="Your ZipCode" value='{{ address.zipcode }}' required></span>
                        <span><h4>Phone Number</h4><input  class="form-control text-center" type="tel" name="phone_number" pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}" placeholder="999-999-9999" value='{{ address.phone_number }}'></span>
                                                            {% comment %} <span><h4>Default Addresss</h4><input  name="billing" type="checkbox" checked ></span> {% endcomment %}
                        <br>
                        <span><input  class="form-control text-center" type="submit" class="btn btn-default" value='Save'></span>
                        </form>
    {% else %}
<div id="text-h1">
        <h1 class="text-center">CHECKOUT</h1>
</div>
<div class="container">
<div class="row">
        <section class="column-1">
            <div class="row1-left">
                <h2 class="text-center">Shipping Information </h2>
                <h4>Name: {{user.first_name}} {{user.last_name}}</h4>
                <h4>Address: {{address.address}} {{address.city}}, {{address.state}} {{address.zipcode}} <h4>
                <h4>Phone Number: {{address.phone_number}}</h4>
                {% comment %} <h4>{{ address.get_address}}</h4> {% endcomment %}
                <div class="panel-group">
                            <div class="panel panel-default">
                                    <div class="panel-heading">
                                            <h4 class="panel-title">
                                            <a data-toggle="collapse" href="#collapse2">
                                                    <h6 class="text-center">Change Address?</h6></a>
                            <div id="collapse2" class="panel-collapse collapse">
                                    <ul>
                                            <li class="list-group-item">
            
                                                    <form action="{%  url "checkout" %}" method="POST">
                                                                    {% csrf_token %}
                                                            {% comment %} <span><h4>Address</h4><input class="form-control text-center" name='address' placeholder='Your address' value='{{address.shipping.address}}' type="text" required></span> {% endcomment %}
                                                            <span><h4>Address</h4><input class="form-control text-center" name='address' placeholder='Your address' value='{{ address.address }}' type='text' required></span>
                                                            <span><h4>City</h4><input class="form-control text-center" name='city' placeholder='Your City' value='{{ address.city }}' type="text" required></span>
                                                            <span><h4>State</h4>
                                                            <select style=" text-align: center; text-align-last: center;" class="form-control text-center" id="sel"  name="state" >
                                                                <option value="Andhra Pradesh">Andhra Pradesh</option>
                                                                <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                                                                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                                                <option value="Assam">Assam</option>
                                                                <option value="Bihar">Bihar</option>
                                                                <option value="Chandigarh">Chandigarh</option>
                                                                <option value="Chhattisgarh">Chhattisgarh</option>
                                                                <option value="Dadar and Nagar Haveli">Dadar and Nagar Haveli</option>
                                                                <option value="Daman and Diu">Daman and Diu</option>
                                                                <option value="Delhi">Delhi</option>
                                                                <option value="Lakshadweep">Lakshadweep</option>
                                                                <option value="Puducherry">Puducherry</option>
                                                                <option value="Goa">Goa</option>
                                                                <option value="Gujarat">Gujarat</option>
                                                                <option value="Haryana">Haryana</option>
                                                                <option value="Himachal Pradesh">Himachal Pradesh</option>
                                                                <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                                <option value="Jharkhand">Jharkhand</option>
                                                                <option value="Karnataka">Karnataka</option>
                                                                <option value="Kerala">Kerala</option>
                                                                <option value="Madhya Pradesh">Madhya Pradesh</option>
                                                                <option value="Maharashtra">Maharashtra</option>
                                                                <option value="Manipur">Manipur</option>
                                                                <option value="Meghalaya">Meghalaya</option>
                                                                <option value="Mizoram">Mizoram</option>
                                                                <option value="Nagaland">Nagaland</option>
                                                                <option value="Odisha">Odisha</option>
                                                                <option value="Punjab">Punjab</option>
                                                                <option value="Rajasthan">Rajasthan</option>
                                                                <option value="Sikkim">Sikkim</option>
                                                                <option value="Tamil Nadu">Tamil Nadu</option>
                                                                <option value="Telangana">Telangana</option>
                                                                <option value="Tripura">Tripura</option>
                                                                <option value="Uttar Pradesh">Uttar Pradesh</option>
                                                                <option value="Uttarakhand">Uttarakhand</option>
                                                                <option value="West Bengal">West Bengal</option>
                                                            </select>	
                                                            </span>
                                                            <span><h4>Zipcode</h4><input  class="form-control text-center" name="zipcode" type="text" inputmode="numeric" pattern="^(?(^00000(|-0000))|(\d{5}(|-\d{4})))$" placeholder="Your ZipCode" value='{{ address.zipcode }}' required></span>
                                                            <span><h4>Phone Number</h4><input  class="form-control text-center" type="tel" name="phone_number" pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}" placeholder="999-999-9999" value='{{ address.phone_number }}'></span>
                                                            {% comment %} <span><h4>Default Addresss</h4><input  name="billing" type="checkbox" checked ></span> {% endcomment %}
                                                            <br>
                                                            <span><input  class="form-control text-center" type="submit" class="btn btn-default" value='Save'></span>
                                                    </form>
                                                    
                                    </ul>     
                            </div>
                    </div>    
            </div>
            
            
            <div class="row2-left">
                        
                    <div class="panel-group">
                            <div class="panel panel-default">
                                    <div class="panel-heading">
                                            <h4 class="panel-title">
                                            <a data-toggle="collapse" href="#collapse-item">
                                                   <h4 class="text-item">Total Items: </h4></a>
                                                   {{ cart.totalCount }} Items
                            <div id="collapse-item" class="panel-collapse collapse">
                                    <ul>
                                            <li class="list-group-item">

                                                    <table class="table table-checkout">
                                                        <thead>
                                                                <tr>
                                                                <th scope="col">Item</th>
                                                                <th scope="col">Price</th>
                                                                <th scope="col">Qty</th>   
                                                                </tr>
                                                        </thead>                  

                                                        <tbody>
                                                            {% for item in cart.cartitem_set.all %}
                                                            <tr>
                                                                <td><h6>{{item.product.title }}</h6></td>
                                                                <td>{{ item.product.salePrice }}</td>
                                                                {% comment %} the input  of the number of items {% endcomment %}
                                                                <td>{{ item.quantity }}</td>
                                                            </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                            </li>                   
                                    </ul>     
                            </div>
                    </div> 
            </div>
        
            <div class="row3-left" >
                    {% if order.shipping_date == None %}
                            <div class="panel-group">
                                    <div class="panel panel-default">
                                            <div class="panel-heading">
                                                    <h4 class="panel-title">
                                                    <a data-toggle="collapse" href="#collapse-dateShipping1">
                                                        <h4 class="text-item">CHOOSE DATE SHIPPING</h4></a>
                                    <div id="collapse-dateShipping1" class="panel-collapse ">
                                            <ul>
                                                    <li class="list-group-item">
                                                        <form action="{%  url "time_shipping" %}" method="POST" required>
                                                            {% csrf_token %}
                                                                <input type="radio"   name="shipping_date" id="{{one_day}}" value="{{one_day}}" required><label for="{{one_day}}">{{one_day}}</label><br>
                                                                <input type="radio"  name="shipping_date" id="{{three_days}}" value="{{three_days}}"><label for="{{three_days}}">{{three_days}}</label><br>
                                                                <input type="radio" name="shipping_date" id="{{seven_days}}" value="{{seven_days}}"><label for="{{seven_days}}">{{seven_days}}</label><br>
                                                                <button class="button" type="submit">Save</button>
                                                        </form>
                                                    </li>                   
                                            </ul>     
                                    </div>
                            </div>
            
                    {% else %}
                
                    <div class="panel-group">
                                    <div class="panel panel-default">
                                            <div class="panel-heading">
                                                    <h4 class="panel-title">
                                                   
                                                    <a data-toggle="collapse" href="#collapse-dateShipping">
                                                        <h4 class="text-item">Shipping Date</h4></a>{{ order.shipping_date }}
                                    <div id="collapse-dateShipping" class="panel-collapse collapse">
                                            <ul>
                                                    <li class="list-group-item">
                                                        <form action="{%  url "time_shipping" %}" method="POST" required>
                                                            {% csrf_token %}
                                                                <input type="radio"   name="shipping_date" id="{{one_day}}" value="{{one_day}}" required><label for="{{one_day}}">{{one_day}}</label><br>
                                                                <input type="radio"  name="shipping_date" id="{{three_days}}" value="{{three_days}}"><label for="{{three_days}}">{{three_days}}</label><br>
                                                                <input type="radio" name="shipping_date" id="{{seven_days}}" value="{{seven_days}}"><label for="{{seven_days}}">{{seven_days}}</label><br>
                                                                <button class="button" type="submit">Save</button>
                                                        </form>
                                                    </li>                   
                                            </ul>     
                                    </div>
                    </div> 
        </div>
    </section>
            

    <section class="column-2">
        <div class="row1-right">  
                    <div class="panel-group">
                                    <div class="panel panel-default">
                                            <div class="panel-heading">
                                                    <h4 class="panel-title">
                                                    
                                                    <a data-toggle="collapse" href="#collapse-total">
                                                        <h4 class="text-item"> Total </h4></a><h4 class="text-center">₹{{ order.finalTotal }}</h4>
                                    <div id="collapse-total" class="panel-collapse collapse">
                                            <ul>
                                                    <li class="list-group-item">
                                                        <h6>Shipping Fee: ₹{{ order.shipping_price }} </h6>                   
                                <h6>Tax: 9.25%</h6>
                                <h6>Subtotal: ₹{{ order.subTotal }}</h6>
                                                    </li>                   
                                            </ul>     
                                    </div>
                    </div> 
                                
                                
        </div> 
        <div class="row2-right">
            <h1 class="text-center" style="padding: 30px">Credit Info </h1>
                        <!-- Set up a container element for the button -->
                            <div id="paypal-button-container"></div>

                            <!-- Include the PayPal JavaScript SDK -->
                            <script src="https://www.paypal.com/sdk/js?client-id=AR_QmwsLAI3poN5Q5dQ1RhRoK1BHSY-qh5OA0lUbqja4F_SI3f8zN2ZsasczCNJjjtLw5MoO3c1JybQy&currency=USD"></script>

                            <script>
                                // Render the PayPal button into #paypal-button-container
                                paypal.Buttons({
                                    

                                    // Set up the transaction
                                    createOrder: function(data, actions) {
                                        return actions.order.create({
                                            purchase_units: [{
                                                amount: {
                                                    value: {{ order.finalTotal }}
                                                }
                                            }]
                                        });
                                    },

                                    // Finalize the transaction
                                    onApprove: function(data, actions) {
                                        return actions.order.capture().then(function(details) {
                                            // Show a success message to the buyer
                                            alert('Transaction completed by ' + details.payer.name.given_name + '!');
                                            location.href="{% url 'success' %}" //this will redirect to your index
                                        });
                                    }


                                }).render('#paypal-button-container');
                            </script>
                            {% comment %} ###################################################################### {% endcomment %}
                            </div>
                   
            
        </div>
    </section>
            {% endif %}
 {% endif %}

</body>



{% comment %} ############################Do not fix or touch it ######################################### {% endcomment %}

{% comment %}  This method is using "sandbox of paypal" of developer
Account user: minhanh6998@gmail.com to check
Account bussiness: minhanh6998Business@gmail.com 
Remember want to activate should get the client-id and copy it to line 36 at "client-id "
{% endcomment %}
<script>
        var obj = document.getElementById("sel");
        for(i=0; i<obj.options.length; i++){
        if(obj.options[i].value == '{{address.state}}' ){
                obj.selectedIndex = i;
        }
        }
</script>


{% endblock content %}
